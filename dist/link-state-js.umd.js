var X=Object.defineProperty;var Y=(c,f,m)=>f in c?X(c,f,{enumerable:!0,configurable:!0,writable:!0,value:m}):c[f]=m;var u=(c,f,m)=>(Y(c,typeof f!="symbol"?f+"":f,m),m);(function(c,f){typeof exports=="object"&&typeof module!="undefined"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(c=typeof globalThis!="undefined"?globalThis:c||self,f(c.LinkStateJS={}))})(this,function(c){"use strict";const f=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","truespeed"];class m{constructor(t,e,s,i){u(this,"element");u(this,"attributeName");u(this,"valueFunction");u(this,"states");u(this,"staticValue");u(this,"isBooleanAttribute");var o;this.element=t,this.attributeName=e,this.valueFunction=s,this.states=i,this.staticValue=(o=t.getAttribute(this.attributeName))!=null?o:"",this.isBooleanAttribute=f.includes(this.attributeName),this.update()}update(){this.element.removeAttribute(this.attributeName);const t=this.valueFunction();if(!this.isBooleanAttribute||t){const e=this.staticValue?[this.staticValue,t].join(" "):t;this.element.setAttribute(this.attributeName,e),this.attributeName==="value"&&(this.element.value=e)}}destroy(){for(const t of this.states)t.unsubscribe(this)}}class B{constructor(t,e,s){u(this,"element");u(this,"eventName");u(this,"listener");this.element=t,this.eventName=e,this.listener=s,this.element.addEventListener(this.eventName,this.listener)}update(){throw new Error("Method not implemented.")}destroy(){this.element.removeEventListener(this.eventName,this.listener)}}class ${constructor(t,e,s=void 0){u(this,"element");u(this,"targetAttribute");u(this,"state");u(this,"statePath");u(this,"eventListener");this.element=t,this.state=e;const i=s==null?void 0:s.indexOf(".");this.statePath=i&&i!==-1?s==null?void 0:s.substring(i+1):void 0,this.targetAttribute=t.getAttribute("type")==="checkbox"?"checked":"value",this.eventListener=o=>{const r=o.target;r&&(this.statePath&&this.state.value?this.state.value.setValueForPath(this.statePath,r[this.targetAttribute]):this.state.value=r[this.targetAttribute])},this.element.addEventListener("input",this.eventListener),this.update()}update(){var t;this.element[this.targetAttribute]=(t=this.state.value)==null?void 0:t.getValueForPath(this.statePath)}destroy(){this.state.unsubscribe(this),this.element.removeEventListener("input",this.eventListener)}}function F(n,t){const e=t.parentElement;if(!e)return;const s=t.nextSibling;e.insertBefore(n,s)}function j(n,t){const e=t.parentElement;!e||e.insertBefore(n,t)}class M{constructor(t,e,s){u(this,"element");u(this,"condition");u(this,"states");u(this,"ifComment");u(this,"isElementRendered");this.element=t,this.condition=e,this.states=s,this.ifComment=document.createComment("link-state-js-if"),j(this.ifComment,t),this.update()}update(){const t=this.condition();t?(!this.isElementRendered||this.isElementRendered===void 0)&&(this.isElementRendered=t,F(this.element,this.ifComment)):(this.isElementRendered||this.isElementRendered===void 0)&&(this.isElementRendered=t,this.element.remove())}destroy(){for(const t of this.states)t.unsubscribe(this);this.ifComment.remove()}}class E{constructor(t,e,s){u(this,"element");u(this,"valueFunction");u(this,"states");this.element=t,this.valueFunction=e,this.states=s,this.update()}update(){this.element.textContent=this.valueFunction()}destroy(){for(const t of this.states)t.unsubscribe(this)}}class k{constructor(t){u(this,"_value");u(this,"subscribers",[]);this._value=t,this._value instanceof Array?this._value=new Proxy(this._value,{get:(e,s,i)=>{const o=Reflect.get(e,s,i);return s==="push"||s==="shift"||s==="unshift"||s==="pop"||s==="sort"?(...r)=>{e[s](...r),this.notify()}:s==="splice"?(r,a)=>{e[s](r,a),this.notify()}:o}}):this._value instanceof Object&&(this._value=new Proxy(this._value,{set:(e,s,i,o)=>{const r=Reflect.set(e,s,i,o);return this.notify(),r}}))}set value(t){this.set(t)}get value(){return this._value}set(t){this._value!==t&&(this._value=t,this.notify())}setPathValue(t,e){this._value.setValueForKeyPath(t,e),this.notify()}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}notify(){for(const t of this.subscribers)t.update()}}class q{constructor(t,e,s,i,o){u(this,"element");u(this,"itemName");u(this,"state");u(this,"parentStates");u(this,"foreachSetup");u(this,"template");u(this,"loopInstances");u(this,"forComment");this.element=t,this.itemName=e,this.state=s,this.parentStates=i,this.foreachSetup=o,this.template=this.element.cloneNode(!0),this.loopInstances=new Map,this.forComment=document.createComment("link-state-js-for"),j(this.forComment,t),this.element.remove(),this.update()}update(){this.resetLoop(),this.insertLoopChildren()}resetLoop(){for(const[t,e]of this.loopInstances.entries())t.remove(),R(...e);this.loopInstances.clear()}insertLoopChildren(){const t=Array.from(this.state.value);for(let e=t.length-1;e>=0;e--){const s=t[e],i=this.template.cloneNode(!0),o=x({element:i,setupFunction:()=>{const r={};for(const a of Object.keys(this.parentStates))r[a]=this.parentStates[a];if(r[this.itemName]=new k(s),r._index=new k(e),this.foreachSetup){const a=this.foreachSetup({element:i,states:r})||{};for(const l of Object.keys(a))r[l]=a[l]}return r}});F(i,this.forComment),this.loopInstances.set(i,o)}}destroy(){this.state.unsubscribe(this),this.forComment.remove()}}class T{constructor(t,...e){u(this,"watcher");u(this,"states");this.watcher=t,this.states=e}init(){}update(){this.watcher()}destroy(){for(const t of this.states)t.unsubscribe(this)}}class W{constructor(t,e){u(this,"value");u(this,"computer");u(this,"parents",[]);u(this,"subscribers",[]);this.computer=t,this.value=this.computer(),this.parents=e}update(){this.value=this.computer(),this.notify()}destroy(){for(const t of this.parents)t.unsubscribe(this)}notify(){for(const t of this.subscribers)t.update()}notifyParents(){for(const t of this.parents)t.notify()}set(){}setPathValue(){}subscribe(t){this.subscribers.push(t)}unsubscribe(t){const e=this.subscribers.indexOf(t);e!==-1&&this.subscribers.splice(e,1)}}function g(n,t){if(!t||!n)return n;const e=t.indexOf(".");if(e!==-1){const s=t.substring(e+1),i=s.indexOf(".");return i!==-1?g(n[s.substring(0,i)],s):n[s]}return n}function D(n){const t=n.indexOf(".");if(t!==-1)return n.substring(0,t);const e=n.indexOf("(");return e!==-1?n.substring(0,e):n}Object.defineProperty(Object.prototype,"setValueForKey",{value:function(n,t){this[t]=n}}),Object.defineProperty(Object.prototype,"setValueForPath",{value:function(n,t){if(n==null)return;if(n.indexOf(".")===-1){this.setValueForKey(t,n);return}const e=n.split("."),s=e.shift(),i=e.join(".");s&&this[s].setValueForPath(i,t)}}),Object.defineProperty(Object.prototype,"getValueForKey",{value:function(n){return this[n]}}),Object.defineProperty(Object.prototype,"getValueForPath",{value:function(n){if(n==null)return this;if(n.indexOf(".")===-1)return this.getValueForKey(n);var t=n.split("."),e=t.shift(),s=t.join(".");if(e)return this[e].getValueForPath(s)}});function J(n){return new k(n)}function L(n,...t){const e=new W(n,t);for(const s of t)s.subscribe(e);return e}function z(n,...t){const e=new T(n,...t);for(const s of t)s.subscribe(e);return e}let y=document;function h(n){const t=y instanceof Element&&y.matches(n)&&y||y.querySelector(n);if(!t)throw new Error(`Element not found with given selector ${n}. Please make sure element exists.`);return t}function G(n,t){return[n,...Array.from(n.querySelectorAll(t))].filter(s=>s.matches(t))}function V({selector:n,element:t=h(n),text:e,states:s}){const i=new E(t,e,s);for(const o of s)o.subscribe(i);return i}function H({selector:n,element:t=h(n),state:e}){const s=new E(t,()=>e.value,[e]);return e.subscribe(s),s}function S({selector:n,element:t=h(n),name:e,value:s,states:i}){const o=new m(t,e,s,i);for(const r of i)r.subscribe(o);return o}function Q({selector:n,element:t=h(n),name:e,state:s}){return S({element:t,name:e,value:()=>`${s.value}`,states:[s]})}function C({selector:n,element:t=h(n),state:e,statePath:s}){const i=new $(t,e,s);return e.subscribe(i),i}function N({selector:n,element:t=h(n),condition:e,states:s}){const i=new M(t,e,s);for(const o of s)o.subscribe(i);return i}function _({selector:n,element:t=h(n),itemName:e,state:s,parentStates:i={},foreachSetup:o}){const r=new q(t,e,s,i,o);return s.subscribe(r),r}function I({selector:n,element:t=h(n),trigger:e,listener:s}){return new B(t,e,s)}function x({selector:n,element:t=h(n),setupFunction:e}){y=t;const s=e({element:t});let i=[];return s&&(i=K({element:t,states:s})),y=document,i}function R(...n){for(const t of n)t.destroy()}function K({selector:n,element:t=h(n),states:e}){const s=[];let i=!1;return b(t,e,"data-state-setup",(o,{listener:r})=>{!r||(x({element:o,setupFunction:r}).forEach(a=>s.push(a)),i=!0)}),i||(b(t,e,"data-state-foreach",(o,{state:r,companion:a})=>{if(!r||!a)return;o.removeAttribute("data-state-foreach");const l=o.getAttribute("data-state-foreach-setup"),d=l!==null?e[l]:void 0;s.push(_({element:o,state:r,itemName:a,parentStates:e,foreachSetup:d}))}),b(t,e,"data-state-text",(o,{state:r,statePath:a,listener:l})=>{if(!r&&!l)return;let d,p;if(r)d=r,p=[r];else{const v=w(l,a,e);d=L(()=>v.listener(),...v.states),p=v.states}s.push(V({element:o,text:()=>g(d.value,a),states:p}))}),b(t,e,"data-state-attribute",(o,{state:r,companion:a,statePath:l,listener:d})=>{if(!r&&!d&&!a)return;let p,v;if(r)p=r,v=[r];else{const O=w(d,l,e);p=L(()=>O.listener(),...O.states),v=O.states}s.push(S({element:o,name:a,value:()=>g(p.value,l),states:v}))}),b(t,e,"data-state-model",(o,{state:r,statePath:a})=>{!r||s.push(C({element:o,state:r,statePath:a}))}),b(t,e,"data-state-listener",(o,{listener:r,companion:a,statePath:l})=>{!r||!a||s.push(I({element:o,trigger:a,listener:w(r,l,e).listener}))}),b(t,e,"data-state-rendered",(o,{state:r,statePath:a})=>{!r||s.push(N({element:o,condition:()=>g(r.value,a),states:[r]}))})),s}function b(n,t,e,s){for(const i of G(n,`[${e}]`))for(let o of i.getAttribute(e).split(";")){o=o.trim();const r=o.indexOf(")");if(o.startsWith("(")&&r!==-1){const a=U(o,t);if(!a)continue;s(i,{state:a,companion:o.substring(r+2).trim()})}else{const a=A(o,t);if(!a.state&&!a.listener)continue;s(i,a)}}}function U(n,t){const e=[];for(const s of n.substring(1,n.indexOf(")")).trim().split(",")){const i=A(s.trim(),t);i.companion&&i.state&&e.push(i)}if(e.length>0){const s=e.map(i=>i.state);return L(()=>e.map(({state:i,companion:o,statePath:r})=>`${o}:${g(i.value,r)}`).join(";"),...s)}}function w(n,t,e){var i;const s=t==null?void 0:t.indexOf("(");if(s&&s!==-1){const o=[];for(const r of((i=t==null?void 0:t.substring(s+1,t==null?void 0:t.indexOf(")")))==null?void 0:i.split(","))||[]){const a=A(r.trim(),e);a.state&&o.push(a)}return{listener:r=>{const a=[];for(const l of o)a.push(l.state.value);return n(...a,r)},states:o.map(r=>r.state)}}return{listener:n,states:[]}}function A(n,t){const[e,s]=n.split("@");let i=t[D(e)],o;return i instanceof Function&&(o=i,i=void 0),{state:i,listener:o,statePath:e,companion:s}}c.attribute=S,c.attributeState=Q,c.autoLink=K,c.computed=L,c.destory=R,c.listener=I,c.loop=_,c.model=C,c.rendered=N,c.setup=x,c.state=J,c.text=V,c.textState=H,c.watch=z,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
